# HyloReactNative
Version 2 of the Hylo mobile app, built with React Native.

## Basic development how-to

#### First time

1. Follow the instructions in [Getting Started](https://facebook.github.io/react-native/docs/getting-started.html).

2. Set up your `.env.development` file, e.g.:

```
API_HOST=https://www.hylo.com
IOS_EMULATOR_API_HOST=http://localhost:3001
ANDROID_EMULATOR_API_HOST=http://10.0.2.2:3001
IOS_GOOGLE_CLIENT_ID=xyza.apps.googleusercontent.com
WEB_GOOGLE_CLIENT_ID=xyzw.apps.googleusercontent.com
```

It's crucial to remember that, unlike a server-side `.env`, these values are _not protected_ and will be bundled into code that is sent to the user's device. If there's anything that a user isn't supposed to know about: keys, passwords, hashes etc, best practice is to store them behind the API and not client-side.


#### Every time

1. Run `yarn start`; this starts the "packager", which is a server that bundles up the JS and serves it to the app running on the simulator or device.

2. Run `react-native run-ios` or `react-native run-android`; this compiles the native app and deploys it to the simulator.
  - It will open the iOS simulator automatically, but the Android emulator must already be running (or a development-mode device connected).
  - If you run this without starting the packager yourself, it will start it up in Terminal but it may not behave the same way when started like that because of differing working directories. So start the packager yourself first.

3. When you make changes to the app code, the packager will update its bundle and hot-reload it in the simulator. You can also force-refresh the simulator (Cmd-R in iOS, R R in Android).
  - To enable this (at least in Android) with develop on device, you may need to explicitly enable it in the debug menu (see next point).

4. From within the simulator, you can bring up a developer menu (shake or Cmd-D on iOS, shake or Cmd-M on Android) to enable remote debugging among other things.


## Gotchas

- Crashing with `Your app is missing support for the following URL schemes: com.googleusercontent.apps...`
  - [Read this](https://developers.google.com/identity/sign-in/ios/start-integrating#add_a_url_scheme_to_your_project) and make sure the value of `IOS_GOOGLE_CLIENT_ID` in your `.env` file matches the value of `CLIENT_ID` in the `GoogleService-info.plist` file in the XCode project.


## Android-specific

  - When developing on device, you might want to proxy the API port on the device (probably 3001) to the same port on the machine it's connected to via USB. ADB is pretty happy to do this for you, with:

  ```
  adb reverse tcp:3001 tcp:3001
  ```

  - Note that if you see a warning about differing ADB versions, that's not so good: basically, it will kill the previous ADB process with all the React Native debugging goodness on it (mainly via port 8081) and start another. To avoid this, make sure you're using the same ADB version. Most of the time you won't see this issue unless you have more than one ADB installed.

  - If you're doing the adb reverse trick, you should change `ANDROID_EMULATOR_API_HOST` to something like `http://localhost:3001`. If not, stick with `10.0.2.2:3001` because ADB proxies that IP to localhost when using the emulator. (You could also use the actual IP of your development machine on the LAN, if that IP's not changing too frequently.)

  - If you encounter an error regarding a missing `GradleWrapperMain` class, it's possible your `android/gradle/wrapper/gradle-wrapper.jar` has become corrupt or is missing. It can be generated by installing gradle and running `gradle wrapper`, copying the resulting directory structure and files into `android`.

  - If you encounter an error regarding a mismatch in build tools version, note that we force all android projects to use v25 currently. This is to correspond to the minimum required build tools for the gradle version we use.

## Updating icon fonts

If you have made changes to the "hylo-evo-icons" font in IcoMoon, select the "Download JSON" option from [the menu](https://www.dropbox.com/s/jv5itcspwfhg0uk/icomoon-menu.png?dl=0), and replace `components/Icon/config.json` with the contents of that downloaded file. Also update the `hylo-evo-icons.ttf` file in two places: `src/assets` and `android/app/src/main/assets/fonts`.
